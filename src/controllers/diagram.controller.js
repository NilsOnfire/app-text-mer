const e = require('express');
const { ChatGPT } = require('../utils/diagram');
const { splitMermaidObject, getEntitiesWithAttribs, getRelations } = require('../utils/converter');

/**
 * 
 * @param {e.Request} req 
 * @param {e.Response} res 
 */
exports.generateDiagram = async (req, res) => {
    //parsed into text plain
    const input = req.body;
    const chat = new ChatGPT();
    try {
        let prompt = chat.generatePrompt(input);
        // asyncronic function  to wait the result generated by gpt
        const data = await chat.generateResponse(input, prompt);
        res.status(200).json({ response: data });
    } catch (error) {
        res.status(400).json({ error });
    }
};